let title = document.getElementById("title");
let price = document.getElementById("price");
let tax = document.getElementById("Tax");
let ads = document.getElementById("ads");
let discount = document.getElementById("discount");
let total = document.getElementById("total");
let count = document.getElementById("count");
let cateogry = document.getElementById("cateogry");
let submit = document.getElementById("submit");
//console.log(title,price,Tax,ads,discount,total,count,cateogry,submit);

//create variable mode to create or update:
let mode = 'create'; //default

//«·„ €Ì— «·ÊÂ„Ï «Ê «·„”«⁄œ : ⁄‰œﬂ „ €Ì— ›Ï ›«‰ﬂ‘‰ Ê⁄«Ê“  ” Œœ„Â ›Ï «·Ã·Ê»«·
let tmp; // global
//Function : Get Total :
function getTotal (){
    if(price.value != ''){
        let result = (+price.value + +tax.value + +ads.value) - +discount.value;
        total.innerHTML = result;
        total.style.background = 'green';
    }else{
        total.innerHTML = '';
        total.style.background = 'red';
    }
}

//Function to create new product and save it in local storage :


//to save data in localstorage in reload :
let prods;
if(localStorage.product != null){
    prods = JSON.parse(localStorage.product);
}else{
    prods = [];
}

//submit : Do create if mode = create or update if mode is update
submit.onclick = function(){
    // create product details in objct and push it in array :
    let newProd = {
        title : title.value.toLowerCase(), //·„«  «Œœ «·»Ì«‰«  ŒœÂ« Õ—Ê› ’€Ì—…
        price : price.value,
        tax : tax.value,
        ads : ads.value,
        discount : discount.value,
        total : total.innerHTML,
        count : count.value,
        cateogry : cateogry.value.toLowerCase()
    };

    
    if(title.value != '' && price.value !='' &&cateogry.value && newProd.count < 100){  //newprod.count Ì⁄‰Ï «·ﬂÊ‰  «· Ã«Ì«·ﬂ „‰ «·«Ê»ÃÌﬂ 
        //create prod if mode is create :
        if(mode === "create"){
            //if count > 1 «‰‘«¡ „‰ Ã Ê«Õœ «Ê ⁄œ… „‰ Ã« :
      if(newProd.count > 1){
          for(let x = 0;x < newProd.count ; x++){
              prods.push(newProd);
          }
      }else{
          prods.push(newProd);
          
      }
  
      }else{
          //update product in index : edit prod in array,and add new data from product inputs object
          prods[tmp] = newProd; //tmp : product index u want update and take it from update function on click ,, «Œ– »Ì«‰«  «·«»ÊÃÌﬂ  ÊÊ÷⁄Â« ›Ï «·„‰ Ã «·„ÿ·Ê» ›Ï «·«—«Ï
  
          // after update return create mode :
          mode = 'create';
          submit.innerHTML='create';
          count.style.display = 'block';
      }
      //don't clear inputs ≈·« «–« œŒ·  „‰ Ã ÃœÌœ
      clearInputs (); //after if condition in true
      //«„«  Õ  ›„⁄‰«Â« ⁄«„… «„”Õ «·ÕﬁÊ· ›Ï «Ï Ê÷⁄
    }
  
    // after push store in local storage :;
    localStorage.setItem('product',JSON.stringify(prods));
    showData();

    
}

//clear data after create product :
function clearInputs (){
    title.value='';
    price.value='';
    tax.value='';
    ads.value='';
    discount.value='';
    total.innerHTML='';
    count.value='';
    cateogry.value='';
} 
//show products in table after create and always shown :
function showData(){
    let newRow = '';
   for(let x = 0 ; x < prods.length ; x++){
    newRow += `
    <tr>
        <td>${x +1}</td>
        <td>${prods[x].title}</td>
        <td>${prods[x].price}</td>
        <td>${prods[x].tax}</td>
        <td>${prods[x].ads}</td>
        <td>${prods[x].discount}</td>
        <td>${prods[x].total}</td>
        <td>${prods[x].cateogry}</td>
        <td><button id="update" onclick="updateData(${x})" >update</button></td>
        <td><button id="delete" onclick="deleteProd(${x})">delete</button></td>
    </tr>
       `}
       document.getElementById("tbody").innerHTML = newRow;

       //create btn deletaAll if array contains data appear in show :
       let deleteAll = document.getElementById("deleteAll");
       if(prods.length > 0){
        //create the button :
        deleteAll.innerHTML = `<button onclick="deleteAllBtn()">Delete All (${prods.length})</button>`;
       }else{
        deleteAll.innerHTML ='';
       }

       //to update total and change style,after show :
       getTotal();

    }


showData();

//Delete product :
function deleteProd (x){
    prods.splice(x,1);
    localStorage.product = JSON.stringify(prods);
    showData();
}

//Function Delete All :
function deleteAllBtn(){
 //update array and local storage  and show data:
 localStorage.clear();
 prods.splice(0);
 showData();
}

//UpdateData :
function updateData(prodIndex){

    console.log(prodIndex);
    title.value = prods[prodIndex].title;
    price.value = prods[prodIndex].price;
    tax.value = prods[prodIndex].tax;
    ads.value = prods[prodIndex].ads;
    discount.value = prods[prodIndex].discount;
    cateogry.value = prods[prodIndex].cateogry;

    //get total run onkeyup only;run it in update:
    getTotal();
    //delete count input,and change innerhtml in cretae btn :
    count.style.display = 'none';
    submit.innerHTML = 'update'; 
    mode="update";
    tmp = prodIndex; // tmp global  «’»Õ  „ﬂ‘Ê›… ·ﬂ «·›«‰ﬂ‘‰

    //scroll top to my product :
   scroll({
       top:0,
       behavior:'smooth'
   })
}

// search : 
let search = document.getElementById("search");
let searchMode = 'title';  // to change search mode
function getSearchMode(id){
  //⁄·Ï Õ”» ¬Ï œÏ «·“—«— :·„« «÷€ÿ ⁄·Ï “—«— ›ÌÂ„ Ì€Ì— „Êœ «·»ÕÀ Ê‰’ ﬂ… «·“—«—
 if(id === "searchTitle"){
    searchMode = 'title';
 
 }else{
     searchMode = 'cateogry';
 }

 search.placeholder = 'search By ' + searchMode;

 //onclick any btn focus input search :
 search.focus();
//after change inner btn empty search :
search.value = '';
showData();
}

//search : Func run onkeyup search input , when u click get value from input search:
function searchData(inputValue){

    let newRow='';

    for(let x = 0 ; x < prods.length ; x++){
//search mode  title  cateogry
    if(searchMode == 'title'){
        //·Ê ﬂ »  ›Ï «·”Ì—‘ ﬂ·„… «œŒ· ⁄·Ï ﬂ· «·„‰ Ã«  Ê«»ÕÀ ›Ï «· «Ì · » «⁄Â« ⁄‰ ﬂ·„…  Õ ÊÏ ⁄·Ï ‰’ „‘«»Â ·· ›Ï „—»⁄ «·»ÕÀ
        //search in title in all products , searh in string with : includes(word or letter)
        
            if(prods[x].title.includes(inputValue.toLowerCase())){ //data user enter lowercase to compare with title in lowercase
                 //show in table , will return the product that contain search value :
                 newRow += `
                    <tr>
                        <td>${x}</td>
                        <td>${prods[x].title}</td>
                        <td>${prods[x].price}</td>
                        <td>${prods[x].tax}</td>
                        <td>${prods[x].ads}</td>
                        <td>${prods[x].discount}</td>
                        <td>${prods[x].total}</td>
                        <td>${prods[x].cateogry}</td>
                        <td><button id="update" onclick="updateData(${x})" >update</button></td>
                        <td><button id="delete" onclick="deleteProd(${x})">delete</button></td>
                    </tr>
                    `;
            }
        }
        //search with cateogry : 

    else {

       
            if(prods[x].cateogry.includes(inputValue.toLowerCase())){ 
                 //show in table , will return the product that contain search value :
                 newRow += `
                    <tr>
                        <td>${x}</td>
                        <td>${prods[x].title}</td>
                        <td>${prods[x].price}</td>
                        <td>${prods[x].tax}</td>
                        <td>${prods[x].ads}</td>
                        <td>${prods[x].discount}</td>
                        <td>${prods[x].total}</td>
                        <td>${prods[x].cateogry}</td>
                        <td><button id="update" onclick="updateData(${x})" >update</button></td>
                        <td><button id="delete" onclick="deleteProd(${x})">delete</button></td>
                    </tr>
                    `;
            }
        }
    }
    
    // put row in table :
    document.getElementById("tbody").innerHTML = newRow;
}